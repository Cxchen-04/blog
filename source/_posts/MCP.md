---
title: MCP 大模型上下文协议
date: 2025-06-12 18:11:27
tags: [大模型, 协议]
categories: [AI, MCP]
---

## 背景
与聊天机器人交流时，大模型需要记住之前的内容，才能给出连贯的
回答。这些历史消息就叫做“上下文”。如果上下文丢失，模型就会
答非所问。MCP（Model Context Protocol）是一套简单的记录规则，
帮助我们在不同系统间共享这些对话信息。

### 为什么要用 MCP

- **统一格式**：所有服务都按同一种方式保存和读取对话，避免混乱。
- **模型互通**：一套协议即可让多个模型或插件共享上下文。
- **可追溯**：消息按节点存储，随时能查到每一步说了什么。

## 协议结构

### 核心概念

- **Conversation**：一次完整的聊天，对应唯一的会话 ID。
- **ContextNode**：单条消息节点，记录角色和内容，可指向上一条消息。
- **Metadata**：附加信息，如模型参数或插件状态。

### 简单示例

```json
{
  "conversation_id": "123456",
  "nodes": [
    {
      "id": "node1",
      "role": "user",
      "content": "你好，MCP 是什么？",
      "timestamp": 1718200000
    },
    {
      "id": "node2",
      "role": "assistant",
      "content": "MCP 是一种用于管理大模型对话上下文的协议。",
      "parent": "node1",
      "timestamp": 1718200001
    }
  ]
}
```
这里每条消息都通过 `parent` 字段与上一条相连，形成清晰的对话
链路。若需引用更早的内容，可在节点中列出 `reference`。

### 上下文管理

服务器保存整个会话，只在需要时把相关片段传给模型。客户端只需
告诉服务器最新的节点编号，无须重复发送所有历史消息。

## 参考实现

社区中有 Node.js 的 `mcp-js` 等轻量库，可自动记录消息并从数据
库读取。推理前按顺序拼接文本即可。

## 与其他系统的区别

传统 API 更多关注“一问一答”，而 MCP 记录了消息之间的关系。
通过会话 ID 和父子节点，我们可以重现完整的聊天过程。

## 未来展望

未来可能还会出现图片、语音等富媒体内容。MCP 的开放结构允许在
`Metadata` 或节点中扩展新字段，方便适应更多场景。

