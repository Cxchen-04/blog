---
title: Prometheus+Grafana
date: 2025-03-30 13:43:43
tags: [运维,监控,]
categories: [运维,监控,Prometheus+Grafana]
cover: /images/监控.png
---
## 简介
#### 🔍 Prometheus 是什么？

Prometheus 是一个“监控和数据采集系统”，简单理解就是一个“收集数据的仓库+大脑”。

📦 它主要做这些事：
	•	采集数据：比如服务器的 CPU 使用率、内存占用、网络流量、请求次数等。
	•	存储数据：把这些数据以时间序列的形式存到自己的数据库里。
	•	查询数据：支持用专门的 PromQL 语言查询、筛选、聚合各种指标。
	•	设置告警：可以设置规则，当某个指标异常时触发告警（例如 CPU 连续5分钟超过 90%）。

👀 简单说，它是“采集、存、查、报”的一套系统，不负责可视化。

#### 📊 Grafana 是什么？

Grafana 是一个数据可视化工具，用来“把数据变成图表”。

🎨 它主要做这些事：
	•	连接数据源：比如连接 Prometheus，读取里面的指标数据。
	•	绘制图表和仪表盘：你可以用它制作漂亮的图、线、饼图、热图等各种形式。
	•	设置仪表盘：将不同的数据组合成统一的监控面板，便于一眼看出系统健康状况。
	•	告警通知：Grafana 也支持设置告警（但数据还是从 Prometheus 来）。

👀 简单说，它是“读数 + 画图 + 展示”的一套系统，不负责采集和存储。

## 安装
#### 步骤一 安装Node Exporter（监控服务器性能）
Node Exporter是Prometheus的官方工具，可以帮助采集服务器的硬件指标（CPU、内存、磁盘等）。

``` bash Ubuntu
ssh root@你的服务器ip

sudo useradd --no-create-home --shell /bin/false node_exporter
# 创建node_exporter用户(安全起见)

wget https://github.com/prometheus/node_exporter/releases/download/v1.7.0/node_exporter-1.7.0.linux-amd64.tar.gz
tar xvf node_exporter-1.7.0.linux-amd64.tar.gz
sudo cp node_exporter-1.7.0.linux-amd64/node_exporter /usr/local/bin/
# 下载并解压node_exporter

sudo nano /etc/systemd/system/node_exporter.service
# 设置systemd启动服务
```
写入以下内容
``` bash Ubuntu
[Unit]
Description=Node Exporter
After=network.target

[Service]
User=node_exporter
ExecStart=/usr/local/bin/node_exporter #文件路径

[Install]
WantedBy=default.target
```
启动并设置开机启动
``` bash Ubuntu
sudo systemctl daemon-reexec
sudo systemctl start node_exporter
sudo systemctl enable node_exporter
```
测试一下：
打开浏览器访问：
http://你的服务器IP:9100/metrics
如果能看到一堆指标文字，说明成功！

#### 步骤二 安装Prometheus
下载Prometheus：
``` bash Ubuntu
wget https://github.com/prometheus/prometheus/releases/download/v2.50.0/prometheus-2.50.0.linux-amd64.tar.gz
tar xvf prometheus-2.50.0.linux-amd64.tar.gz # 解压
cd prometheus-2.50.0.linux-amd64 
# 进入文件夹里面创建.yml文件

nano prometheus.yml # 创建prometheus配置文件
```
写入一下内容：
``` bash Ubuntu
global:         # 一定要写正确格式，包括空格以及重复定义
  scrape_interval: 15s

scrape_configs:
  - job_name: 'node_exporter'
    static_configs: # 这个可能会有冲突 
      - targets: ['localhost:9100'] 

  - job_name: 'website_http_check'
    metrics_path: /probe
    params:
      module: [http_2xx]
    static_configs:
      - targets:
          - http://你的域名或者IP
    relabel_configs:
      - source_labels: [__address__]
        target_label: __param_target
      - source_labels: [__param_target]
        target_label: instance
      - target_label: __address__
        replacement: localhost:9115  # blackbox_exporter 监听端口
```

#### 步骤三 安装Blackbox Exporter(探测网站状态)
``` bash Ubuntu
wget https://github.com/prometheus/blackbox_exporter/releases/download/v0.25.0/blackbox_exporter-0.25.0.linux-amd64.tar.gz
tar xvf blackbox_exporter-0.25.0.linux-amd64.tar.gz
cd blackbox_exporter-0.25.0.linux-amd64 
./blackbox_exporter     # 进入文件夹启动
# 也可以添加systemd启动服务，和node_exporter类似。
```

#### 步骤四 启动prometheus
``` bash Ubuntu
./prometheus --config.file=prometheus.yml
```
访问浏览器：
http://你的服务器IP:9090，你应该可以看到 Prometheus 的 Web 页面。

#### 📊 步骤五：安装 Grafana
``` bash
sudo apt-get install -y apt-transport-https software-properties-common
# 安装依赖
 
sudo apt-get install -y wget
wget -q -O - https://packages.grafana.com/gpg.key | sudo apt-key add -
echo "deb https://packages.grafana.com/oss/deb stable main" | sudo tee /etc/apt/sources.list.d/grafana.list
sudo apt-get update
# 添加grafana仓库

sudo apt-get install grafana
sudo systemctl start grafana-server
sudo systemctl enable grafana-server
# 安装并启动grafana
```
访问grafana：
浏览器打开 http://你的服务器IP:3000，默认账号密码是：
用户名：admin
密码：admin  登录之后会要求修改密码

#### 📈 步骤六：配置 Grafana
	1.	添加数据源：选择 Prometheus，填入 http://localhost:9090
	2.	导入 Dashboard 模板：
	•	Node Exporter：导入模板 ID 1860
	•	Blackbox 网站状态：导入模板 ID 7587



### 运行服务器

``` bash
$ hexo server
```

更多信息: [服务端](https://hexo.io/docs/server.html)

### 生成静态文件

``` bash
$ hexo generate
```

更多信息: [生成](https://hexo.io/docs/generating.html)

### 部署到远程仓库

``` bash
$ hexo deploy
```

更多信息: [部署](https://hexo.io/docs/one-command-deployment.html)
