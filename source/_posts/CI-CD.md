---
title: DevOps ä¸–ç•Œçš„çµé­‚æŠ€æœ¯ï¼šCI/CD æµæ°´çº¿
date: 2025-04-13 12:21:48
cover: /images/cicd.png
---

DevOps ä¸–ç•Œçš„çµé­‚æŠ€æœ¯ï¼šCI/CD æµæ°´çº¿

## ä»€ä¹ˆæ˜¯ CI/CD æµæ°´çº¿
CI/CD = æŒç»­é›†æˆ + æŒç»­äº¤ä»˜ / æŒç»­éƒ¨ç½²
æ˜¯ä¸€æ•´å¥—â€œè‡ªåŠ¨åŒ–æµæ°´çº¿â€ï¼Œç”¨æ¥è®©è½¯ä»¶å¼€å‘ä»æäº¤ä»£ç  â†’ è‡ªåŠ¨æ„å»º â†’ è‡ªåŠ¨æµ‹è¯• â†’ è‡ªåŠ¨éƒ¨ç½²ï¼Œä¸€æ¡é¾™å®Œæˆ
### CI/CD æ˜¯å¹²å˜›çš„
``` Plaintext
ä½ å†™ä»£ç  â†’ æ¨é€åˆ° GitHub / GitLab
           â†“
      âœ… CI é˜¶æ®µï¼ˆæŒç»­é›†æˆï¼‰
      - è‡ªåŠ¨ç¼–è¯‘æ‰“åŒ…
      - è‡ªåŠ¨è·‘å•å…ƒæµ‹è¯•
      - è‡ªåŠ¨ä»£ç æ£€æŸ¥
           â†“
      ğŸš€ CD é˜¶æ®µï¼ˆæŒç»­äº¤ä»˜ / éƒ¨ç½²ï¼‰
      - è‡ªåŠ¨æ„å»º Docker é•œåƒ
      - è‡ªåŠ¨å‘å¸ƒåˆ°æµ‹è¯• / ç”Ÿäº§ç¯å¢ƒ
      - è‡ªåŠ¨é€šçŸ¥ï¼ˆé’‰é’‰ / Slackï¼‰
```
### CI/CD å„é˜¶æ®µéƒ½å¹²äº†å•¥ï¼Ÿ
| é˜¶æ®µ              | ä¸­æ–‡å                   | åšä»€ä¹ˆä¸¾åŠ¨ï¼Ÿ                            |
|-------------------|--------------------------|-----------------------------------------|
| CIï¼ˆæŒç»­é›†æˆï¼‰     | Continuous Integration    | è‡ªåŠ¨æµ‹è¯• + æ‰“åŒ…æ„å»º                     |
| CDï¼ˆæŒç»­äº¤ä»˜ï¼‰     | Continuous Delivery       | è‡ªåŠ¨å‘å¸ƒåˆ°æµ‹è¯•ç¯å¢ƒï¼Œäººå·¥ç¡®è®¤ä¸Šçº¿        |
| CDï¼ˆæŒç»­éƒ¨ç½²ï¼‰     | Continuous Deployment     | è‡ªåŠ¨å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒï¼Œæ— äººå·¥å¹²é¢„          |

<p>å…¸å‹çš„æµæ°´çº¿é•¿è¿™æ ·</p>

``` Yaml
# Gitlab CI ç¤ºä¾‹ .gitlab-ci.yml
stages:
    - build
    - test
    - deploy

build:
    stage: build
    script:
        - npm install 
        - npm run build
    artifacts:
        path:
            - dist/

test:
    stage: test
    script:
        - npm test

deploy:
    stage: deploy
    script:
        - docker build -t my-app .
        - docker push myregistry.com/my-app
        - ssh deploy@server 'docker pull my-app && docker restart my-app'
```
### ğŸ›  å¸¸ç”¨ CI/CD å·¥å…·å¹³å°æœ‰å“ªäº›ï¼Ÿ
| å·¥å…·                  | è¯´æ˜                                 | æ¨èæŒ‡æ•°                           |
|-----------------------|--------------------------------------|------------------------------------|
| GitHub Actions        | GitHub åŸç”Ÿæ”¯æŒï¼Œç®€å•æ˜“ä¸Šæ‰‹          | â­â­â­â­â­                            |
| GitLab CI/CD          | GitLab è‡ªå¸¦ CI/CDï¼Œé›†æˆåº¦é«˜           | â­â­â­â­                             |
| Jenkins               | å¼€æºç•Œè€ç‰Œ CI/CD å·¥å…·                 | â­â­â­â­ï¼ˆé€‚åˆè‡ªå®šä¹‰å¤æ‚æµç¨‹ï¼‰         |
| Gitea + Drone         | ç§æœ‰éƒ¨ç½²ç»„åˆ                          | â­â­â­                              |
| CircleCI / Travis CI | å›½å¤–æµè¡Œï¼ŒGitHub é¡¹ç›®å¤š               | â­â­â­ï¼ˆé™å…è´¹é¢åº¦ï¼‰                  |

<p>ğŸ’¡ ç°å®ä¾‹å­ï¼šéƒ¨ç½²ä¸€ä¸ª Vue é¡¹ç›® + åç«¯æœåŠ¡</p>

1. å¼€å‘äººå‘˜æäº¤ä»£ç åˆ° GitHub
2. GitHub Actions è‡ªåŠ¨è§¦å‘ï¼š
â€¢	è¿è¡Œæµ‹è¯•
â€¢	æ‰§è¡Œæ„å»ºï¼ˆnpm run buildï¼‰
â€¢	æ‰“åŒ…ä¸º Docker é•œåƒ
â€¢	æ¨é€åˆ° Docker Hub / ç§æœ‰ä»“åº“
â€¢	SSH ç™»å½•æœåŠ¡å™¨è¿œç¨‹éƒ¨ç½² / ä½¿ç”¨ K8s æ»šåŠ¨æ›´æ–°
â€¢	é€šçŸ¥é’‰é’‰ / é‚®ä»¶ç¾¤â€œéƒ¨ç½²å®Œæˆâ€

ğŸ‰ å…¨ç¨‹ä¸ç”¨ä½ æ‰‹ç‚¹ï¼Œè‡ªåŠ¨å®Œæˆ
### CI/CD çš„ä»·å€¼æ€»ç»“
| å¥½å¤„         | æè¿°                                             |
|--------------|--------------------------------------------------|
| ğŸ§¹ é™ä½äººä¸ºé”™è¯¯ | å‡å°‘éƒ¨ç½²å‡ºé”™ã€ç¯å¢ƒä¸ä¸€è‡´ç­‰é—®é¢˜                    |
| ğŸš€ åŠ å¿«è¿­ä»£é€Ÿåº¦ | æäº¤ä»£ç åå‡ åˆ†é’Ÿå°±èƒ½ä¸Šçº¿                         |
| ğŸ“¦ æé«˜è´¨é‡     | æ¯æ¬¡æäº¤éƒ½è·‘æµ‹è¯•ï¼Œä»£ç æ›´ç¨³å®š                      |
| ğŸ¤ æå‡å›¢é˜Ÿåä½œ | æ‰€æœ‰äººæŒ‰ç»Ÿä¸€æ ‡å‡†éƒ¨ç½²ï¼Œä¸å®¹æ˜“æ··ä¹±                  |
| ğŸ”„ æ˜“äºå›æ»š     | ç‰ˆæœ¬æ‰“åŒ…æœ‰è®°å½•ï¼Œå¯éšæ—¶åˆ‡å›                       |

## ä½¿ç”¨
ä»¥æ­¤åšå®¢ä½œä¸ºå®æˆ˜é¡¹ç›®ã€‚ä½¿ç”¨GitHub Actionsä½œä¸ºæµæ°´çº¿å·¥å…·ğŸ”§
1. ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ
å®ç°ä¸€ä»¶äº‹ï¼šæˆ‘æ”¹å®Œåšå®¢å†…å®¹ï¼Œpush åˆ° GitHubï¼ŒæœåŠ¡å™¨è‡ªåŠ¨æ›´æ–°ä¸Šçº¿ï¼Œä¸ç”¨æˆ‘ç‚¹å‹ç¼©ã€FTPï¼
2. ç›®å‰çš„å·¥å…·ç»„åˆ
| å·¥å…·                        | ç”¨æ³•                           | è¯´æ˜                       |
|-----------------------------|--------------------------------|----------------------------|
| GitHub + GitHub Actions     | æ‰˜ç®¡ä»£ç  + æ‰§è¡Œ CI/CD æµæ°´çº¿   | å…è´¹ã€å¥½ç”¨                 |
| SSH + rsync                 | è‡ªåŠ¨è¿œç¨‹ä¸Šä¼ ä»£ç                | æ›¿ä»£ FTPï¼Œæ›´å¿«æ›´ç¨³         |
| Nginx                       | ä½ å·²ç»éƒ¨ç½²å¥½äº†ï¼Œç”¨ä½œ Web æœåŠ¡  | æ ¹ç›®å½•æŒ‚è½½ç½‘ç«™å†…å®¹         |

### ç›®å½•ç»“æ„
å¦‚æœæ²¡æœ‰workflows éœ€è¦æ‰‹åŠ¨åˆ›å»ºï¼
``` bash
æˆ‘çš„åšå®¢/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ deploy.yml      ğŸ‘ˆ GitHub Actions æµæ°´çº¿è„šæœ¬
â”‚   â””â”€â”€ dependabot.yml      
â”œâ”€â”€ public/                 ğŸ‘ˆ æ„å»ºåè¾“å‡ºç›®å½•
â”œâ”€â”€ package.json / config.yml
```
### GitHub Actionsè‡ªåŠ¨éƒ¨ç½²è„šæœ¬
``` Yaml
name: è‡ªåŠ¨éƒ¨ç½²åšå®¢åˆ°æœåŠ¡å™¨

on: 
   push:
        branches:
            - main  # ä½¿ç”¨çš„åˆ†æ”¯ï¼Œå¦‚æœæ˜¯master ä¿®æ”¹è¿™é‡Œ

jobs:
    deploy:
        runs-on: ubuntu-latest

        steps:
            - name: æ‹‰ä»£ç 
              uses: actions/checkout@v3

            - name: å®‰è£…Node.js 
              uses: actions/setup-node@v3
              with:
                node-version: 18       
            
            - name: å®‰è£…ä¾èµ– & æ„å»ºåšå®¢ 
              run: |
                npm install 
                npm install -g hexo-cli
                npx hexo generate
            # å¦‚æœåªéœ€è¦ä¸Šä¼ èµ„æºåˆ°æœåŠ¡å™¨ å¯ä»¥çœå»å®‰è£…node å’Œhexoçš„ä¾èµ–

            - name: ä¸Šä¼ åˆ°æœåŠ¡å™¨
              uses: easingthemes/ssh-deploy@v2.1.5
              with:
                SSH_PRIVATE_KEY: ${{ secrets.SERVER_SSH_KEY }}
                REMOTE_USER: root   # ä½ çš„æœåŠ¡å™¨ç”¨æˆ·å
                REMOTE_HOST: x.x.x.x    # ä½ çš„æœåŠ¡å™¨IP
                TARGET: /var/www/html   # ä½ nginxçš„æ ¹ç›®å½• å†™åˆ°æ ¹ä¸Šä¸€ä¸ªæ–‡ä»¶å¤¹
                SOURCE: public/         # ä½ ç½‘é¡µçš„èµ„æº
                
```
### é…ç½®æœåŠ¡å™¨ SSH å¯†é’¥
1. åœ¨æœ¬åœ°æ‰§è¡Œå‘½ä»¤ç”Ÿæˆå¯†é’¥ï¼š
``` bash
ssh-keygen -t rsa -b 4096 -C "you@example.com"
```
2. æ‹·è´å…¬é’¥åˆ°æœåŠ¡å™¨ï¼š
``` bash
ssh-copy-id your_user@your.server.ip
```
æˆ–è€…æ‰‹åŠ¨æŠŠ ï½/.ssh/id_rsa.pubçš„å†…å®¹è¿½åŠ åˆ°æœåŠ¡å™¨çš„ï¼š
``` bash
~/.ssh/authorized_keys
```
3. æŠŠç§é’¥~/.ssh/id_rsa çš„å†…å®¹å¤åˆ¶ï¼Œç²˜è´´åˆ° GitHub ä»“åº“ä¸­ï¼š
GitHub â†’ Settings â†’ Secrets â†’ Actions â†’ New repository secret
åå­—å«ï¼šSERVER_SSH_KEY
å€¼æ˜¯ä½ ç§é’¥çš„å†…å®¹ï¼ˆæ³¨æ„å®‰å…¨ï¼Œä¸è¦æ³„éœ²ï¼‰

### ä¿®æ”¹ REMOTE_USERã€REMOTE_HOSTã€TARGET
æ¯”å¦‚ä½ æœåŠ¡å™¨ç”¨æˆ·åæ˜¯ rootï¼Œå…¬ç½‘ IP æ˜¯ 1.2.3.4ï¼Œéƒ¨ç½²è·¯å¾„æ˜¯ /var/www/htmlï¼Œé‚£ä½ å°±å¡«
``` Yaml
REMOTE_USER: root
REMOTE_HOST: 1.2.3.4
TARGET: /var/www/html
```

### æœ€å æ¨é€è¯•è¯•ï¼
``` bash
git add .
git commit -m "é¦–æ¬¡æ·»åŠ è‡ªåŠ¨éƒ¨ç½²"
git push origin main
```
ğŸŒŸ ç„¶åè¿›å…¥ GitHub â†’ Actionsï¼Œå°±èƒ½çœ‹åˆ°å®ƒè‡ªåŠ¨æ‰§è¡Œï¼

éƒ¨ç½²æˆåŠŸåï¼Œä½ å°±å¯ä»¥è®¿é—® http:// your.server.ip æŸ¥çœ‹æ•ˆæœï¼
ğŸ’¡ å°å»ºè®®ï¼šå¯é€‰åŠ ä¸€è¡Œæ—¥å¿—æ‰“å°
``` Yaml
- name: æŸ¥çœ‹æ„å»ºç»“æœæ–‡ä»¶å¤¹
  run: ls -al public/ 
```