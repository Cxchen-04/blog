[{"title":"ä½ å¥½ï¼Œæˆ‘çš„ç¬¬ä¸€ç¯‡blog","url":"/2025/03/19/hello-world/","content":"æ¬¢è¿å…‰ä¸´chençš„åšå®¢ï¼è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« ã€‚æŸ¥çœ‹[ä»‹ç»]è·å–æ›´å¤šä¿¡æ¯ã€‚å¦‚æœä½ åœ¨ä½¿ç”¨æˆ‘çš„ç½‘ç«™æ—¶é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œä½ å¯ä»¥åœ¨[æ•…éšœæ’é™¤]ä¸­æ‰¾åˆ°ç­”æ¡ˆï¼Œæˆ–è€…ä½ å¯ä»¥åœ¨GitHubä¸Šé—®æˆ‘ã€‚\nå¿«é€Ÿå¼€å§‹åˆ›å»ºä¸€ç¯‡åšå®¢$ hexo new &quot;My New Post&quot;\n\næ›´å¤šä¿¡æ¯: æ–‡ç« \nè¿è¡ŒæœåŠ¡å™¨$ hexo server\n\næ›´å¤šä¿¡æ¯: æœåŠ¡ç«¯\nç”Ÿæˆé™æ€æ–‡ä»¶$ hexo generate\n\næ›´å¤šä¿¡æ¯: ç”Ÿæˆ\néƒ¨ç½²åˆ°è¿œç¨‹ä»“åº“$ hexo deploy\n\næ›´å¤šä¿¡æ¯: éƒ¨ç½²\n"},{"title":"Python","url":"/2025/03/26/Python/","content":"","categories":["æœåŠ¡ç«¯","Python"],"tags":["æœåŠ¡ç«¯ï¼ŒPython"]},{"title":"Shell","url":"/2025/03/26/Shell/","content":"","categories":["æœåŠ¡ç«¯","Shell"],"tags":["æœåŠ¡ç«¯","Shell"]},{"title":"docker","url":"/2025/03/25/docker/","content":"Docker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼ŒåŸºäº Go è¯­è¨€ å¹¶éµä»Apache2.0åè®®å¼€æºã€‚Docker å¯ä»¥è®©å¼€å‘è€…æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªè½»é‡çº§ã€å¯ç§»æ¤çš„å®¹å™¨ä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„ Linux æœºå™¨ä¸Šï¼Œä¹Ÿå¯ä»¥å®ç°è™šæ‹ŸåŒ–ã€‚å®¹å™¨æ˜¯å®Œå…¨ä½¿ç”¨æ²™ç®±æœºåˆ¶ï¼Œç›¸äº’ä¹‹é—´ä¸ä¼šæœ‰ä»»ä½•æ¥å£ï¼ˆç±»ä¼¼ iPhone çš„ appï¼‰,æ›´é‡è¦çš„æ˜¯å®¹å™¨æ€§èƒ½å¼€é”€æä½ã€‚\nç®€ä»‹å®¹å™¨æŠ€æœ¯ä¸ä»…é™äºdockerï¼Œä½†æ˜¯dockerç›®å‰æœ€ä¸ºæµè¡Œï¼Œdockerå®¹å™¨æŠ€æœ¯çš„æ ¸å¿ƒä¹‹ä¸€åœ¨äºé•œåƒæ–‡ä»¶ã€‚é•œåƒæ–‡ä»¶ï¼Œé€šä¿—çš„ç†è§£å°±æ˜¯ä¸€ä¸ªè¿›ç¨‹è¿è¡Œæ—¶ä¾èµ–çš„è½¯ä»¶æ–‡ä»¶çš„é›†è£…ç®±ã€‚\nâ€ƒâ€ƒåº”ç”¨é›†ç¾¤éƒ¨ç½²æ—¶ï¼Œæ¯å°æœºå™¨é¦–å…ˆä¼šæ‹‰å–æŒ‡å®šç‰ˆæœ¬çš„é•œåƒæ–‡ä»¶ã€‚å®‰è£…é•œåƒåäº§ç”Ÿäº†dockerå®¹å™¨ã€‚ç”±äºæ‰€æœ‰æœºå™¨çš„é•œåƒæ–‡ä»¶ä¸€æ ·ï¼Œå®¹å™¨çš„è½¯ä»¶ç‰ˆæœ¬æ•…è€Œä¸€æ ·ã€‚å³ä½¿å¼€å‘æˆ–è¿ç»´ä¸­é€”ä¿®æ”¹äº†å®¹å™¨çš„è½¯ä»¶ç‰ˆæœ¬ï¼Œä½†æ˜¯å®¹å™¨é”€æ¯æ—¶ï¼Œè½¯ä»¶çš„æ”¹åŠ¨ä¼šéšå®¹å™¨çš„é”€æ¯ä¸€èµ·æ¹®ç­ã€‚å½“åº”ç”¨ç”¨å·²æœ‰çš„é•œåƒæ–‡ä»¶é‡æ–°éƒ¨ç½²æ—¶ï¼Œç”Ÿæˆçš„dockerå®¹å™¨è·Ÿä¿®æ”¹ä¹‹å‰çš„å®¹å™¨å®Œå…¨ä¸€æ ·ã€‚è¿™ä¹Ÿæ˜¯Infrastructure as codeæ€æƒ³å¸¦æ¥çš„å¥½å¤„ã€‚\nâ€ƒâ€ƒå®¹å™¨å¦‚æœè¦å‡çº§è½¯ä»¶ç‰ˆæœ¬ï¼Œé‚£å°±ä¿®æ”¹é•œåƒæ–‡ä»¶ã€‚è¿™æ ·éƒ¨ç½²æ—¶é›†ç¾¤å†…æ‰€æœ‰çš„æœºå™¨é‡æ–°æ‹‰å–æ–°çš„é•œåƒï¼Œè½¯ä»¶å› æ­¤è·Ÿç€ä¸€èµ·å‡çº§ã€‚è½¯ä»¶ç‰ˆæœ¬æ··ä¹±çš„é—®é¢˜ï¼Œåˆ°dockerè¿™é‡Œï¼Œä¹Ÿå°±å¾—åˆ°äº†å®Œç¾çš„è§£å†³ã€‚\nä¸€ä¸ªç–‘é—®ï¼šæœ‰äº†å®¹å™¨æŠ€æœ¯ï¼Œç”Ÿäº§ç¯å¢ƒä¸ºä½•è¿˜éœ€è¦éƒ¨ç½²è™šæ‹Ÿæœºï¼Ÿ\nè™šæ‹Ÿæœºèƒ½åšåˆ°ç¡¬ä»¶èµ„æºçš„å½»åº•éš”ç¦»ï¼Œdockerä¸è¡Œã€‚è™šæ‹Ÿæœº å’Œ dockerå„å–é•¿å¤„ï¼Œæœ€ä½³CPã€‚\nå®‰è£…dockerè§£å†³å›½å†…Dockeré•œåƒé—®é¢˜ç”±äº2024å¹´6æœˆå¼€å§‹å›½å†…çš„å¤§é‡dockeré•œåƒåœæœğŸ˜¤ï¼ŒDockeræ— æ³•ä¸‹è½½å®‰è£…ğŸ˜­æ­¤ä»“åº“è‡´åŠ›äºè§£å†³å›½å†…ç½‘ç»œåŸå› æ— æ³•ä½¿ç”¨Dockerçš„é—®é¢˜ä½¿ç”¨Github Actionå°†å®˜ç½‘çš„å®‰è£…è„šæœ¬&#x2F;å®‰è£…åŒ…å®šæ—¶ä¸‹è½½åˆ°æœ¬é¡¹ç›®Releaseï¼Œä¾›å›½å†…ä½¿ç”¨å®˜æ–¹å®‰è£…åŒ…ï¼Œå®‰å…¨å¯é æ¯å¤©è‡ªåŠ¨å®šæ—¶åŒæ­¥ï¼Œä¿è¯æœ€æ–°ä½œè€…ï¼šæŠ€æœ¯çˆ¬çˆ¬è™¾Bç«™ï¼ŒæŠ–éŸ³ï¼ŒYoutubeå…¨ç½‘åŒåï¼Œè½¬è½½è¯·æ³¨æ˜ä½œè€…\nLinuxsudo curl -fsSL https://get.docker.com| bash -s docker --mirror Aliyun #ä¸€é”®å®‰è£…å‘½ä»¤sudo curl -fsSL https://github.com/tech-shrimp/docker_installer/releases/download/latest/linux.sh| bash -s docker --mirror Aliyun# å¤‡ç”¨å‘½ä»¤ï¼ˆæ¯å¤©è‡ªåŠ¨ä»å®˜ç½‘å®šæ—¶åŒæ­¥ï¼‰sudo curl -fsSL https://gitee.com/tech-shrimp/docker_installer/releases/download/latest/linux.sh| bash -s docker --mirror Aliyun# å¤‡ç”¨2 ï¼ˆå¦‚æœgithubè®¿é—®ä¸äº†ï¼Œå¯ä»¥ä½¿ç”¨giteeçš„é“¾æ¥ï¼‰sudo service docker start #å¯åŠ¨Docker\n\nCentoså®‰è£…dockerCentOS 7æˆ–æ›´é«˜ç‰ˆæœ¬å¿…é¡»å¯ç”¨CentOS Extraså­˜å‚¨åº“ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤å­˜å‚¨åº“å·²å¯ç”¨ï¼Œä½†å¦‚æœå·²ç¦ç”¨ï¼Œåˆ™éœ€è¦ é‡æ–°å¯ç”¨å®ƒã€‚å»ºè®®ä½¿ç”¨overlay2å­˜å‚¨é©±åŠ¨ç¨‹åºã€‚å¦‚æœä»¥å‰å®‰è£…çš„è€ç‰ˆæœ¬ï¼ˆDockeråç§°æ˜¯dockeræˆ–docker-engineï¼‰è¯·å…ˆåˆ é™¤\ncentOSsudo yum remove docker \\docker-client \\docker-client-latest \\docker-common \\docker-latest \\docker-latest-logrotate \\docker-logrotate \\docker-engine\nä¸Šè¿°æ“ä½œåªä¼šåˆ é™¤dockeræœ¬èº«ï¼Œä½†è€ç‰ˆæœ¬ä¿å­˜åœ¨&#x2F;var&#x2F;lib&#x2F;docker&#x2F;çš„å†…å®¹ï¼ŒåŒ…æ‹¬é•œåƒã€å®¹å™¨ã€å·å’Œç½‘ç»œéœ€è¦æ‰‹åŠ¨åˆ é™¤ã€‚\nå®‰è£…æ–¹å¼1.è„šæœ¬å®‰è£…(å¤šç”¨äºæµ‹è¯•å’Œå¼€å‘ç¯å¢ƒ)\ncentOScurl -fsSL https://get.docker.com -o get-docker.shsudo sh get-docker.sh\n\n2.ä½¿ç”¨ä»“åº“å®‰è£…(æ¨è)2.1è®¾ç½®dockerä»“åº“\ncentOSsudo yum install -y yum-utils \\device-mapper-persistent-datalvm2sudo yum-config-manager \\--add-repo \\https://download.docker.com/linux/centos/docker-ce.repo\n2.2å®‰è£…docker CE\ncentOSsudo yum install docker-ce docker-ce-cli container.io # å®‰è£…æœ€æ–°çš„Docker CEç‰ˆæœ¬yum list docker-ce --showduplicates | sort -rsudo yum install docker-ce-&lt;VERSION_STRING&gt; docker-ce-cli-&lt;VERSION_STRING&gt; container.io#è¯´æ˜ï¼š&lt;VERSION_STRING&gt;ï¼Œå–ä¸Šå›¾ä¸­ç¬¬äºŒåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªï¼šæˆ–ç¬¬ä¸€ä¸ªæ•°å­—åˆ°-ä¹‹é—´çš„å­—ç¬¦ä¸²ï¼Œå¦‚18.09.6ã€18.06.2.ceç­‰ã€‚\n\n3.ä½¿ç”¨RPMç¨‹åºåŒ…å®‰è£…ï¼ˆé€‚ç”¨äºæ²¡æœ‰äº’è”ç½‘æ¥å…¥çš„æƒ…å†µï¼‰3.1ä¸‹è½½æ‰€éœ€è¦çš„Dockerç‰ˆæœ¬ä¸‹è½½åœ°å€ï¼š https://download.docker.com/linux/centos/7/x86_64/stable/Packages/\ncentOSsudo yum install /path/to/package.rpm# å…¶ä¸­/path/to/package.rpm,ä¸ºä½ ä¸‹è½½ä¸‹æ¥çš„rpmåŒ…æ‰€åœ¨ä½ç½®å’Œæ–‡ä»¶åç§°sudo systemctl start docker# å¯åŠ¨Dockersudo docker run hello-world# éªŒè¯å®‰è£…æ˜¯å¦æ­£ç¡®\næ›´å¤šä¿¡æ¯: Centoså®‰è£…docker\nUbuntuå®‰è£…dockerDocker éœ€è¦åœ¨64ä½ç‰ˆæœ¬çš„Ubuntuä¸Šå®‰è£…ã€‚æ­¤å¤–ï¼Œä½ è¿˜éœ€è¦ä¿è¯ä½ çš„ Ubuntu å†…æ ¸çš„æœ€å°ç‰ˆæœ¬ä¸ä½äº 3.10ï¼Œå…¶ä¸­3.10 å°ç‰ˆæœ¬å’Œæ›´æ–°ç»´æŠ¤ç‰ˆä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨çš„ã€‚\nUbuntuuname -r 3.11.0-15-generic\n\nUbuntuwhich wget # æŸ¥çœ‹ä½ æ˜¯å¦å®‰è£…äº†wgetsudo apt-get update sudo apt-get install wget # å¦‚æœwgetæ²¡æœ‰å®‰è£…ï¼Œå…ˆå‡çº§åŒ…ç®¡ç†å™¨ï¼Œç„¶åå†å®‰è£…å®ƒã€‚wget -qO- https://get.docker.com/ | sh  # è·å–æœ€æ–°ç‰ˆæœ¬çš„ Docker å®‰è£…åŒ…sudo docker run hello-world  # éªŒè¯ Docker æ˜¯å¦è¢«æ­£ç¡®çš„å®‰è£… # ä¸Šè¾¹çš„å‘½ä»¤ä¼šä¸‹è½½ä¸€ä¸ªæµ‹è¯•é•œåƒï¼Œå¹¶åœ¨å®¹å™¨å†…è¿è¡Œè¿™ä¸ªé•œåƒ\næ›´å¤šä¿¡æ¯: Ubuntuå®‰è£…docker\nMacoså®‰è£…dockerHomebrew çš„ Cask å·²ç»æ”¯æŒ Docker for Mac\nMacosbrew cask install docker\nåœ¨è½½å…¥ Docker app åï¼Œç‚¹å‡» Nextï¼Œå¯èƒ½ä¼šè¯¢é—®ä½ çš„ macOS ç™»é™†å¯†ç ï¼Œä½ è¾“å…¥å³å¯ã€‚ä¹‹åä¼šå¼¹å‡ºä¸€ä¸ª Docker è¿è¡Œçš„æç¤ºçª—å£ï¼ŒçŠ¶æ€æ ä¸Šä¹Ÿæœ‰æœ‰ä¸ªå°é²¸é±¼çš„å›¾æ ‡ï¼ˆï¼‰ã€‚\næ›´å¤šä¿¡æ¯: Macosaå®‰è£…docker\nä½¿ç”¨dockerPullé•œåƒæ–¹æ¡ˆä¸€ è½¬å­˜åˆ°é˜¿é‡Œäº‘ä½¿ç”¨github Actionå°†å›½å¤–çš„Dockeré•œåƒè½¬å­˜åˆ°é˜¿é‡Œäº‘ç§æœ‰ä»“åº“ï¼Œä¾›å›½å†…æœåŠ¡å™¨ä½¿ç”¨ï¼Œå…è´¹æ˜“ç”¨æ”¯æŒDockerHub, gcr.io, k8s.io, ghcr.ioç­‰ä»»æ„ä»“åº“æ”¯æŒæœ€å¤§40GBçš„å¤§å‹é•œåƒä½¿ç”¨é˜¿é‡Œäº‘çš„å®˜æ–¹çº¿è·¯ï¼Œé€Ÿåº¦å¿«é¡¹ç›®åœ°å€: Github\næ–¹æ¡ˆäºŒ é•œåƒç«™ç°åœ¨åªæœ‰å¾ˆå°‘çš„å›½å†…é•œåƒç«™å­˜æ´»ä¸ä¿è¯é•œåƒé½å…¨,ä¸”ç”¨ä¸”çæƒœä»¥ä¸‹ä¸‰ä¸ªé•œåƒç«™èƒŒé è¾ƒå¤§çš„å¼€æºé¡¹ç›®ï¼Œä¼˜å…ˆæ¨è\n\n\n\né¡¹ç›®åç§°\né¡¹ç›®åœ°å€\nåŠ é€Ÿåœ°å€\n\n\n\n1Panel\nhttps://github.com/1Panel-dev/1Panel/\nhttps://docker.1panel.live\n\n\nDaocloud\nhttps://github.com/DaoCloud/public-image-mirror\nhttps://docker.m.daocloud.io\n\n\nè€—å­é¢æ¿\nhttps://github.com/TheTNB/panel\nhttps://hub.rat.dev\n\n\nlinuxé…ç½®é•œåƒç«™\nLinuxsudo vi /etc/docker/daemon.json #åˆ›å»º/æ‰“å¼€daemonæ–‡ä»¶&#123;    &quot;registry-mirrors&quot;: [        &quot;https://docker.m.daocloud.io&quot;,        &quot;https://docker.1panel.live&quot;,        &quot;https://hub.rat.dev&quot;    ]&#125;# è¾“å…¥ä»¥ä¸Šå†…å®¹ï¼ŒviæŒ‰escï¼Œè¾“å…¥:wqä¿å­˜  nanoè¾“å…¥ctrl+xä¿å­˜é€€å‡ºsudo service docker restart # é‡å¯docker\n\næ–¹æ¡ˆä¸‰ ç¦»çº¿é•œåƒä½¿ç”¨Github Actionä¸‹è½½dockerç¦»çº¿é•œåƒ https://github.com/wukongdaily/DockerTarBuilder\næ–¹æ¡ˆå›› ä½¿ç”¨ä¸€é”®è„šæœ¬dockerbash -c &quot;$(curl -sSLf https://xy.ggbond.org/xy/docker_pull.sh)&quot; -s å®Œæ•´é•œåƒå\næ–¹æ¡ˆäº” ä½¿ç”¨Cloudflare worker è‡ªå»ºé•œåƒåŠ é€Ÿhttps://github.com/cmliu/CF-Workers-docker.io\nå»å“ªé‡Œæ‰¾é•œåƒhttps://docker.fxxk.dedyn.io/\næ›´å¤šä¿¡æ¯: Github Action\nå¸¸ç”¨çš„æ“ä½œå‘½ä»¤Docker Dockerfilehexo generate\n\næ›´å¤šä¿¡æ¯: ç”Ÿæˆ\nDocker Composehexo deploy\n\næ›´å¤šä¿¡æ¯: éƒ¨ç½²\n","categories":["æœåŠ¡ç«¯","docker"],"tags":["æœåŠ¡ç«¯","docker"]},{"title":"Prometheus+Grafana","url":"/2025/03/30/moniter/","content":"ç®€ä»‹ğŸ” Prometheus æ˜¯ä»€ä¹ˆï¼ŸPrometheus æ˜¯ä¸€ä¸ªâ€œç›‘æ§å’Œæ•°æ®é‡‡é›†ç³»ç»Ÿâ€ï¼Œç®€å•ç†è§£å°±æ˜¯ä¸€ä¸ªâ€œæ”¶é›†æ•°æ®çš„ä»“åº“+å¤§è„‘â€ã€‚\nğŸ“¦ å®ƒä¸»è¦åšè¿™äº›äº‹ï¼š    â€¢\té‡‡é›†æ•°æ®ï¼šæ¯”å¦‚æœåŠ¡å™¨çš„ CPU ä½¿ç”¨ç‡ã€å†…å­˜å ç”¨ã€ç½‘ç»œæµé‡ã€è¯·æ±‚æ¬¡æ•°ç­‰ã€‚    â€¢\tå­˜å‚¨æ•°æ®ï¼šæŠŠè¿™äº›æ•°æ®ä»¥æ—¶é—´åºåˆ—çš„å½¢å¼å­˜åˆ°è‡ªå·±çš„æ•°æ®åº“é‡Œã€‚    â€¢\tæŸ¥è¯¢æ•°æ®ï¼šæ”¯æŒç”¨ä¸“é—¨çš„ PromQL è¯­è¨€æŸ¥è¯¢ã€ç­›é€‰ã€èšåˆå„ç§æŒ‡æ ‡ã€‚    â€¢\tè®¾ç½®å‘Šè­¦ï¼šå¯ä»¥è®¾ç½®è§„åˆ™ï¼Œå½“æŸä¸ªæŒ‡æ ‡å¼‚å¸¸æ—¶è§¦å‘å‘Šè­¦ï¼ˆä¾‹å¦‚ CPU è¿ç»­5åˆ†é’Ÿè¶…è¿‡ 90%ï¼‰ã€‚\nğŸ‘€ ç®€å•è¯´ï¼Œå®ƒæ˜¯â€œé‡‡é›†ã€å­˜ã€æŸ¥ã€æŠ¥â€çš„ä¸€å¥—ç³»ç»Ÿï¼Œä¸è´Ÿè´£å¯è§†åŒ–ã€‚\nğŸ“Š Grafana æ˜¯ä»€ä¹ˆï¼ŸGrafana æ˜¯ä¸€ä¸ªæ•°æ®å¯è§†åŒ–å·¥å…·ï¼Œç”¨æ¥â€œæŠŠæ•°æ®å˜æˆå›¾è¡¨â€ã€‚\nğŸ¨ å®ƒä¸»è¦åšè¿™äº›äº‹ï¼š    â€¢\tè¿æ¥æ•°æ®æºï¼šæ¯”å¦‚è¿æ¥ Prometheusï¼Œè¯»å–é‡Œé¢çš„æŒ‡æ ‡æ•°æ®ã€‚    â€¢\tç»˜åˆ¶å›¾è¡¨å’Œä»ªè¡¨ç›˜ï¼šä½ å¯ä»¥ç”¨å®ƒåˆ¶ä½œæ¼‚äº®çš„å›¾ã€çº¿ã€é¥¼å›¾ã€çƒ­å›¾ç­‰å„ç§å½¢å¼ã€‚    â€¢\tè®¾ç½®ä»ªè¡¨ç›˜ï¼šå°†ä¸åŒçš„æ•°æ®ç»„åˆæˆç»Ÿä¸€çš„ç›‘æ§é¢æ¿ï¼Œä¾¿äºä¸€çœ¼çœ‹å‡ºç³»ç»Ÿå¥åº·çŠ¶å†µã€‚    â€¢\tå‘Šè­¦é€šçŸ¥ï¼šGrafana ä¹Ÿæ”¯æŒè®¾ç½®å‘Šè­¦ï¼ˆä½†æ•°æ®è¿˜æ˜¯ä» Prometheus æ¥ï¼‰ã€‚\nğŸ‘€ ç®€å•è¯´ï¼Œå®ƒæ˜¯â€œè¯»æ•° + ç”»å›¾ + å±•ç¤ºâ€çš„ä¸€å¥—ç³»ç»Ÿï¼Œä¸è´Ÿè´£é‡‡é›†å’Œå­˜å‚¨ã€‚\nå®‰è£…æ­¥éª¤ä¸€ å®‰è£…Node Exporterï¼ˆç›‘æ§æœåŠ¡å™¨æ€§èƒ½ï¼‰Node Exporteræ˜¯Prometheusçš„å®˜æ–¹å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©é‡‡é›†æœåŠ¡å™¨çš„ç¡¬ä»¶æŒ‡æ ‡ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ç­‰ï¼‰ã€‚\nUbuntussh root@ä½ çš„æœåŠ¡å™¨ipsudo useradd --no-create-home --shell /bin/false node_exporter# åˆ›å»ºnode_exporterç”¨æˆ·(å®‰å…¨èµ·è§)wget https://github.com/prometheus/node_exporter/releases/download/v1.7.0/node_exporter-1.7.0.linux-amd64.tar.gztar xvf node_exporter-1.7.0.linux-amd64.tar.gzsudo cp node_exporter-1.7.0.linux-amd64/node_exporter /usr/local/bin/# ä¸‹è½½å¹¶è§£å‹node_exportersudo nano /etc/systemd/system/node_exporter.service# è®¾ç½®systemdå¯åŠ¨æœåŠ¡\nå†™å…¥ä»¥ä¸‹å†…å®¹\nUbuntu[Unit]Description=Node ExporterAfter=network.target[Service]User=node_exporterExecStart=/usr/local/bin/node_exporter #æ–‡ä»¶è·¯å¾„[Install]WantedBy=default.target\nå¯åŠ¨å¹¶è®¾ç½®å¼€æœºå¯åŠ¨\nUbuntusudo systemctl daemon-reexecsudo systemctl start node_exportersudo systemctl enable node_exporter\næµ‹è¯•ä¸€ä¸‹ï¼šæ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp:&#x2F;&#x2F;ä½ çš„æœåŠ¡å™¨IP:9100&#x2F;metricså¦‚æœèƒ½çœ‹åˆ°ä¸€å †æŒ‡æ ‡æ–‡å­—ï¼Œè¯´æ˜æˆåŠŸï¼\næ­¥éª¤äºŒ å®‰è£…Prometheusä¸‹è½½Prometheusï¼š\nUbuntuwget https://github.com/prometheus/prometheus/releases/download/v2.50.0/prometheus-2.50.0.linux-amd64.tar.gztar xvf prometheus-2.50.0.linux-amd64.tar.gz # è§£å‹cd prometheus-2.50.0.linux-amd64 # è¿›å…¥æ–‡ä»¶å¤¹é‡Œé¢åˆ›å»º.ymlæ–‡ä»¶nano prometheus.yml # åˆ›å»ºprometheusé…ç½®æ–‡ä»¶\nå†™å…¥ä¸€ä¸‹å†…å®¹ï¼š\nUbuntuglobal:         # ä¸€å®šè¦å†™æ­£ç¡®æ ¼å¼ï¼ŒåŒ…æ‹¬ç©ºæ ¼ä»¥åŠé‡å¤å®šä¹‰  scrape_interval: 15sscrape_configs:  - job_name: &#x27;node_exporter&#x27;    static_configs: # è¿™ä¸ªå¯èƒ½ä¼šæœ‰å†²çª       - targets: [&#x27;localhost:9100&#x27;]   - job_name: &#x27;website_http_check&#x27;    metrics_path: /probe    params:      module: [http_2xx]    static_configs:      - targets:          - http://ä½ çš„åŸŸåæˆ–è€…IP    relabel_configs:      - source_labels: [__address__]        target_label: __param_target      - source_labels: [__param_target]        target_label: instance      - target_label: __address__        replacement: localhost:9115  # blackbox_exporter ç›‘å¬ç«¯å£\n\næ­¥éª¤ä¸‰ å®‰è£…Blackbox Exporter(æ¢æµ‹ç½‘ç«™çŠ¶æ€)Ubuntuwget https://github.com/prometheus/blackbox_exporter/releases/download/v0.25.0/blackbox_exporter-0.25.0.linux-amd64.tar.gztar xvf blackbox_exporter-0.25.0.linux-amd64.tar.gzcd blackbox_exporter-0.25.0.linux-amd64 ./blackbox_exporter     # è¿›å…¥æ–‡ä»¶å¤¹å¯åŠ¨# ä¹Ÿå¯ä»¥æ·»åŠ systemdå¯åŠ¨æœåŠ¡ï¼Œå’Œnode_exporterç±»ä¼¼ã€‚\n\næ­¥éª¤å›› å¯åŠ¨prometheusUbuntu./prometheus --config.file=prometheus.yml\nè®¿é—®æµè§ˆå™¨ï¼šhttp:&#x2F;&#x2F;ä½ çš„æœåŠ¡å™¨IP:9090ï¼Œä½ åº”è¯¥å¯ä»¥çœ‹åˆ° Prometheus çš„ Web é¡µé¢ã€‚\nğŸ“Š æ­¥éª¤äº”ï¼šå®‰è£… Grafanasudo apt-get install -y apt-transport-https software-properties-common# å®‰è£…ä¾èµ– sudo apt-get install -y wgetwget -q -O - https://packages.grafana.com/gpg.key | sudo apt-key add -echo &quot;deb https://packages.grafana.com/oss/deb stable main&quot; | sudo tee /etc/apt/sources.list.d/grafana.listsudo apt-get update# æ·»åŠ grafanaä»“åº“sudo apt-get install grafanasudo systemctl start grafana-serversudo systemctl enable grafana-server# å®‰è£…å¹¶å¯åŠ¨grafana\nè®¿é—®grafanaï¼šæµè§ˆå™¨æ‰“å¼€ http:&#x2F;&#x2F;ä½ çš„æœåŠ¡å™¨IP:3000ï¼Œé»˜è®¤è´¦å·å¯†ç æ˜¯ï¼šç”¨æˆ·åï¼šadminå¯†ç ï¼šadmin  ç™»å½•ä¹‹åä¼šè¦æ±‚ä¿®æ”¹å¯†ç \nğŸ“ˆ æ­¥éª¤å…­ï¼šé…ç½® Grafanaæ·»åŠ æ•°æ®æºï¼šé€‰æ‹© Prometheusï¼Œå¡«å…¥ http://localhost:9090å¯¼å…¥ Dashboard æ¨¡æ¿ï¼šNode Exporterï¼šå¯¼å…¥æ¨¡æ¿ ID 1860Blackbox ç½‘ç«™çŠ¶æ€ï¼šå¯¼å…¥æ¨¡æ¿ ID 7587\nä½¿ç”¨grafanaæ›´æ”¹ä¸­æ–‡è¦å°†Grafanaé…ç½®ä¸ºä¸­æ–‡ï¼Œä½ å¯ä»¥å‚ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ“ä½œ\n\næ‰“å¼€grafanaçš„é»˜è®¤é…ç½®æ–‡ä»¶ï¼š&#x2F;opt&#x2F;bitnami&#x2F;grafana&#x2F;conf&#x2F;defaults.ini                   &#x2F;usr&#x2F;share&#x2F;grafana&#x2F;conf&#x2F;defaults.ini\nåœ¨è¯¥æ–‡ä»¶ä¸­ï¼Œæ‰¾åˆ°default_languageè¿™ä¸€è¡Œï¼Œå°†en-USæ”¹ä¸ºzh-Hansã€‚è¿™æ ·grafanaçš„è¯­è¨€å°±ä¼šæ›´æ”¹ä¸ºä¸­æ–‡ã€‚\nä¿å­˜å¹¶å…³é—­æ–‡ä»¶\nå¯æœåŠ¡åˆ·æ–°ç½‘é¡µå³å¯systemctl restart grafana-server\n\nç›‘æ§å‘Šè­¦ğŸ› ï¸ æ­¥éª¤ä¸€ï¼šè®¾ç½® Prometheus å‘Šè­¦è§„åˆ™Prometheus æ”¯æŒåŸºäºæŸ¥è¯¢çš„å‘Šè­¦è§„åˆ™ï¼Œä½ å¯ä»¥é€šè¿‡ PromQL è®¾ç½®æ¡ä»¶ï¼Œæ¯”å¦‚å½“ç³»ç»Ÿè´Ÿè½½è¿‡é«˜æ—¶å‘å‡ºå‘Šè­¦ã€‚\n\nåˆ›å»ºå‘Šè­¦è§„åˆ™æ–‡ä»¶åœ¨ Prometheus é…ç½®ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª alert.rules æ–‡ä»¶ï¼ˆå¦‚æœæ²¡æœ‰çš„è¯ï¼‰ï¼šUbuntunano /etc/prometheus/alert.rules # çœ‹ä½ prometheuså®‰è£…/è§£å‹åˆ°äº†å“ªé‡Œ\nåœ¨æ–‡ä»¶ä¸­åŠ å…¥å‘Šè­¦è§„åˆ™ï¼Œä¾‹å¦‚ï¼šYamlgroups:  - name: node_alerts    rules:    - alert: HighCPUUsage       expr: 100 * (1 - avg by (instance) (rate(node_cpu_seconds_total&#123;mode=&quot;idle&quot;&#125;[1m]))) &gt; 80      for: 5m      labels:        severity: critical      annotations:        summary: &quot;CPU usage is above 80% on &#123;&#123; $labels.instance &#125;&#125;&quot;        description: &quot;CPU usage is above 80% for 5 minutes on &#123;&#123; $labels.instance &#125;&#125;.&quot;            - alert: HighLoadAverage      expr: node_load1 &gt; 2      for: 5m      labels:        severity: critical      annotations:        summary: &quot;High load average on &#123;&#123; $labels.instance &#125;&#125;&quot;        description: &quot;The 1-minute load average is above 2 on &#123;&#123; $labels.instance &#125;&#125;.&quot;\nHighCPUUsageï¼šå½“ CPU ä½¿ç”¨ç‡è¶…è¿‡ 80% æŒç»­ 5 åˆ†é’Ÿæ—¶ï¼Œè§¦å‘å‘Šè­¦ã€‚HighLoadAverageï¼šå½“ç³»ç»Ÿ 1 åˆ†é’Ÿå¹³å‡è´Ÿè½½è¶…è¿‡ 2 æ—¶ï¼Œè§¦å‘å‘Šè­¦ã€‚\nä¿®æ”¹ Prometheus é…ç½®æ–‡ä»¶ï¼ŒåŠ è½½å‘Šè­¦è§„åˆ™ç¼–è¾‘ Prometheus é…ç½®æ–‡ä»¶ prometheus.ymlï¼ŒåŠ å…¥è§„åˆ™æ–‡ä»¶ï¼šUbunturule_files:  - &quot;/etc/prometheus/alert.rules&quot;\né‡æ–°å¯åŠ¨ Prometheus\n\nä¿®æ”¹å®Œé…ç½®åï¼Œé‡æ–°å¯åŠ¨ Prometheus æœåŠ¡æ¥åº”ç”¨å‘Šè­¦è§„åˆ™ï¼š\nsudo systemctl restart prometheus\nğŸ› ï¸ æ­¥éª¤äºŒï¼šé…ç½® Grafana å‘Šè­¦é€šçŸ¥ä¸€æ—¦ Prometheus è®¾ç½®äº†å‘Šè­¦è§„åˆ™ï¼Œä½ å°±å¯ä»¥åœ¨ Grafana ä¸­æŸ¥çœ‹å‘Šè­¦å¹¶è®¾ç½®é€šçŸ¥ã€‚\n\nè®¾ç½®é€šçŸ¥æ¸ é“\n\né¦–å…ˆéœ€è¦åœ¨ Grafana é…ç½®ä¸€ä¸ªé€šçŸ¥æ¸ é“ï¼Œå¸¸ç”¨çš„æœ‰ é‚®ä»¶ã€é’‰é’‰ã€Slack ç­‰ã€‚\né…ç½®é‚®ä»¶é€šçŸ¥    1.\tæ‰“å¼€ Grafana UIï¼Œè¿›å…¥ â€œAlertingâ€ &gt; â€œNotification channelsâ€ã€‚    2.\tç‚¹å‡» â€œAdd channelâ€ã€‚    3.\té€‰æ‹©é€šçŸ¥æ–¹å¼ï¼ˆæ¯”å¦‚ Emailï¼‰å¹¶å¡«å†™ç›¸å…³ä¿¡æ¯ï¼š    â€¢\tEmail Addressï¼šæ”¶ä»¶äººé‚®ç®±    â€¢\tSMTPï¼šé…ç½®å‘é€é‚®ä»¶çš„ SMTP æœåŠ¡ï¼ˆå¦‚ Gmail æˆ–è‡ªå·±é…ç½®çš„ SMTPï¼‰\né…ç½®é’‰é’‰&#x2F;Slack é€šçŸ¥\nä½ å¯ä»¥é€‰æ‹©ä½¿ç”¨é’‰é’‰æˆ– Slack çš„ Webhookï¼Œæ­¥éª¤ç±»ä¼¼ï¼Œç›´æ¥å¡«å†™ Webhook URLã€‚\n\né…ç½®å‘Šè­¦è§„åˆ™\n\nåœ¨ Grafana ä¸­ï¼Œè¿›å…¥ä½ è¦ç›‘æ§çš„ Dashboardï¼Œå¹¶è¿›è¡Œå‘Šè­¦è®¾ç½®ï¼š    1.\tæ‰“å¼€éœ€è¦è®¾ç½®å‘Šè­¦çš„å›¾è¡¨ï¼Œç‚¹å‡»å›¾è¡¨å³ä¸Šè§’çš„ â€œAlertâ€ æ ‡ç­¾ã€‚    2.\té…ç½®å‘Šè­¦æ¡ä»¶ï¼Œæ¯”å¦‚ï¼š    â€¢\tå½“ç³»ç»Ÿè´Ÿè½½è¶…è¿‡æŸä¸ªé˜ˆå€¼ã€‚    â€¢\té…ç½®å‘Šè­¦æ—¶é—´ï¼ˆæ¯”å¦‚ 5 åˆ†é’Ÿå†…è§¦å‘ï¼‰ã€‚    3.\tåœ¨ â€œNotificationsâ€ éƒ¨åˆ†ï¼Œé€‰æ‹©ä¹‹å‰é…ç½®å¥½çš„é€šçŸ¥æ¸ é“ï¼ˆæ¯”å¦‚ Emailã€é’‰é’‰ç­‰ï¼‰ã€‚\n\nä¿å­˜å‘Šè­¦è®¾ç½®\n\nè®¾ç½®å®Œæˆåï¼Œç‚¹å‡» â€œSaveâ€ æ¥ä¿å­˜å‘Šè­¦è§„åˆ™ã€‚Grafana ä¼šæ ¹æ®ä½ è®¾ç½®çš„æ¡ä»¶ï¼Œå®šæœŸæ£€æŸ¥ï¼Œå¹¶åœ¨è§¦å‘å‘Šè­¦æ—¶é€šè¿‡é‚®ä»¶æˆ–é’‰é’‰ç­‰æ¸ é“å‘é€é€šçŸ¥ã€‚\nğŸ§‘â€ğŸ’» æ­¥éª¤ä¸‰ï¼šéªŒè¯å‘Šè­¦æ˜¯å¦æœ‰æ•ˆ\nè¦è®© Grafana èƒ½é€šè¿‡ SMTP å‘é€é‚®ä»¶å‘Šè­¦é€šçŸ¥ï¼Œä½ éœ€è¦é…ç½®å®ƒçš„ smtp é‚®ä»¶å‘é€æœåŠ¡ã€‚ä»¥Gmailä¸ºä¾‹\n\n\n\n\né…ç½®é¡¹\nç¤ºä¾‹ï¼ˆä»¥ Gmail ä¸ºä¾‹ï¼‰\n\n\n\nSMTP æœåŠ¡å™¨åœ°å€\nsmtp.gmail.com\n\n\nç«¯å£å·\n587 (TLS) &#x2F; 465 (SSL)\n\n\nå‘ä»¶é‚®ç®±\n&#121;&#111;&#x75;&#x72;&#110;&#x61;&#x6d;&#101;&#x40;&#x67;&#109;&#97;&#105;&#108;&#46;&#x63;&#x6f;&#x6d;\n\n\nå‘ä»¶é‚®ç®±å¯†ç \nGmail ç”Ÿæˆçš„â€œåº”ç”¨ä¸“ç”¨å¯†ç â€\n\n\næ¥æ”¶äººé‚®ç®±\nä»»æ„ä½ æƒ³æ”¶åˆ°å‘Šè­¦çš„äººé‚®ç®±åœ°å€\n\n\n\nä¿®æ”¹ Grafana é…ç½®æ–‡ä»¶ grafana.inié»˜è®¤è·¯å¾„é€šå¸¸æ˜¯ï¼šnano /etc/grafana/grafana.ini\næ‰¾åˆ°ä»¥ä¸‹é…ç½®æ®µè½ï¼ŒæŠŠå®ƒä¿®æ”¹æˆä½ çš„ä¿¡æ¯ï¼ˆæ³¨æ„å–æ¶ˆæ³¨é‡Šï¼‰ï¼šini#################################### SMTP / Emailing ##########################[smtp]enabled = truehost = smtp.gmail.com:587user = yourname@gmail.compassword = your_app_password   ; # Gmail éœ€è¦ä½¿ç”¨â€œåº”ç”¨ä¸“ç”¨å¯†ç â€è€Œä¸æ˜¯ç™»å½•å¯†ç ;cert_file =;key_file =skip_verify = falsefrom_address = yourname@gmail.comfrom_name = Grafana Monitor[emails];welcome_email_on_sign_up = false\nğŸ’¡å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ QQ é‚®ç®±ã€é˜¿é‡Œé‚®ç®±ã€163 ç­‰éƒ½å¯ä»¥ï¼Œæ”¹ä¸‹ hostã€ç«¯å£ã€å¯†ç å³å¯\nğŸ” å…³äº Gmail çš„â€œåº”ç”¨ä¸“ç”¨å¯†ç â€ï¼š\n   ç™»å½•ä½ çš„ Gmail è´¦å·\n   æ‰“å¼€ï¼š https://myaccount.google.com/security\n   å¼€å¯ ä¸¤æ­¥éªŒè¯\n   æ‰¾åˆ°â€œåº”ç”¨ä¸“ç”¨å¯†ç â€ï¼Œåˆ›å»ºä¸€ä¸ªå¯†ç ç”¨äº Grafana å‘é€é‚®ä»¶\n   æ‹·è´è¯¥å¯†ç ï¼Œè´´åˆ°ä¸Šé¢ password ä¸€æ ä¸­\n\n\nğŸ”„é‡å¯ Grafana æœåŠ¡é…ç½®æ”¹å¥½ä¹‹åéœ€è¦é‡å¯ Grafana æ‰èƒ½ç”Ÿæ•ˆï¼šsudo systemctl restart grafana-server\nâœ‰ï¸åœ¨ Grafana ä¸­æµ‹è¯•å‘é€é‚®ä»¶\n   ç™»å½• Grafana â†’ å·¦ä¾§ç‚¹å‡» â€œAlertingâ€ â†’ â€œContact pointsâ€\n   åˆ›å»ºä¸€ä¸ªæ–°çš„ Email é€šçŸ¥æ–¹å¼\n   è¾“å…¥ä½ å¸Œæœ›æ¥æ”¶å‘Šè­¦çš„é‚®ç®±åœ°å€\n   ä¿å­˜åç‚¹å‡» â€œSend test notificationâ€ æ¥éªŒè¯æ˜¯å¦èƒ½æ”¶åˆ°é‚®ä»¶\n\n\n\nâœ… å¦‚æœè®¾ç½®æˆåŠŸï¼Œä½ åº”è¯¥ä¼šåœ¨é‚®ç®±é‡Œçœ‹åˆ°ä¸€ä¸ªæµ‹è¯•é‚®ä»¶ï¼\nğŸ‰ å®Œæˆï¼\n","categories":["è¿ç»´","ç›‘æ§","Prometheus+Grafana"],"tags":["è¿ç»´","ç›‘æ§"]},{"title":"author","url":"/2025/04/04/author/","content":""}]